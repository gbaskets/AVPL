{% extends 'vendor_app/base.html' %}
{% load static %}
{% block title %}Manual Journal Voucher{% endblock %}
{% block main %}

<style>

   .separator{
     display:flex;
     align-items: center; 
     border-bottom: none;
   }
   
   .separator .line{
     height: 1px;
     flex: 1;
     background-color: rgba(0, 0, 0, 0.295);
     border-bottom: none;
   }
   
   .separator h2{
     padding: 0 2rem;
     border-bottom: none;
     font-size: 12px;
   }
   .estimate-button{
      background-color:#00365a;
      color: white; 
      border: none;
   }
   .estimate-button-div{
      display: flex ;
      justify-content:space-between; 
      border: 1px solid; border-style:ridge; 
      padding: 7px;
   }
   #accountTable tr td{
      width: 300px;
      padding-left: 85px;
   }
   #newAccountTable{
      position: relative;
      right: 20px;
       border-collapse: collapse;
       /* border: 1px solid gray; */
       width: 94%;
       float: left;
       top: -18px;
       /* margin: 10px; */
   
   }
   
   </style>
   

            <!-- Main Content -->
            <div class="main-content">
               <section class="section">
                  <div class="section-header">
                     <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                           <div class="section-header-breadcrumb-content">
                              <h1>Manual Journal Voucher</h1>
                              <div class="section-header-breadcrumb">
                                 <div class="breadcrumb-item active"><a href="/vendor/"><i class="fas fa-home"></i></a></div>
                                 <div class="breadcrumb-item"><a href="#">Manual Journal Voucher</a></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="section-body">
                     <div class="row">
                      
                        <div class="col-12">
                           <div class="card">
                              <div class="card-header">
                                 <div class="col-8">
                                    <h4>Manual Journal Voucher List</h4>
                                 </div>
                                    <div class="col-6">
                                       <a  class="btn btn-primary" data-toggle="modal" data-target="#AddProductModal" ><i class="fa fa-plus-circle"></i>Add New Account Ledger</a>
                                    </div>
                              
                                     
                              </div>
                              <div class="card-body">
                                 <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="tableExport" style="width:100%;">
                                       <thead>
                                          <tr>
                                             <th>Sr.</th>
                                             <th>Account Code</th>
                                            
                                             <th>Account Name</th>
                                             <th>Account Type</th>
                                             
                                             <th>Current Balance</th>
                                             <th>Action</th>
                                          </tr>
                                       </thead>
                                       <tbody>
                                          {% for list in accountledgerlist %}
                                          <tr>
                                             <td>{{ list.id|safe }}</td>
                                             <td>{{ list.accountcode|safe }}</td>
                                             <td>{{ list.accountname|safe }}</td>
                                             <td>{{ list.accounttype.name|safe }}</td>
                                             <td>{{ list.openingbalance|safe }} {% if list.transctiontype == "CREDIT" %} CR {% else %} DR {% endif %}</td>
                                              
                                             <td ><a class="btn btn-success btn-icon icon-left" data-toggle="modal" data-target="#EditAccountModal{{list.id}}"><i class="far fa-edit"></i>Edit</a>
                                    
                                          
                                          </tr>
                                          {% endfor %}
                                       </tbody>
                                    </table>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </section>
              
            </div>





{% for list in accountledgerlist %}

 <!-- Modal -->
 <div class="modal fade" id="EditAccountModal{{list.id}}" tabindex="-1" role="dialog" aria-labelledby="EditProductModalLabel{{list.id}}" aria-hidden="true">
   <div class="modal-dialog modal-xl" role="document">
     <div class="modal-content">
      <form action="/vendor/edit-chart-of-account/{{list.id}}" enctype="multipart/form-data"
      method="POST">
      {% csrf_token %}
       <div class="modal-header">
         <h5 class="modal-title" id="EditProductModalLabel{{list.id}}">Edit Account Ledger - {{list.id}}</h5>
      
         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
           <span aria-hidden="true">&times;</span>
         </button>
       </div>
       <div class="modal-body">
     
         <div class="row">
                                       
            <div class="col-lg-4 col-md-12 col-sm-12">
               <div class="form-group">
                  <label>Select Accoun Type</label>

                  <select class="form-control" name="accountype">
                     <option value="">----Select Account----</option>
                     {% for accountype  in accounttypegroups %}
                     <optgroup style="font-size:16px;" label="{{accountype.name}}">{{accountype.name}}</optgroup>
                     
                     {% for first in accountype.accounttypegroups.all %}
                   
                     <option style="font-size:16px;" value="{{first.id}}" {% if list.accounttype.id == first.id %} selected {% else %} {%endif %}>{{first.name}}</option>
                     {% endfor %}
                     {% endfor %}
                  </select>
               </div>
            
            </div>
            
            <div class="col-lg-4 col-md-12 col-sm-12">
               <div class="form-group">
                  <label>Account Code</label>
                  <input type="text" class="form-control" value="{{list.accountcode}}" disabled>
               </div>   
            </div>
          
            <div class="col-lg-4 col-md-12 col-sm-12">
               <div class="form-group">
                  <label>Account Name</label>
                  <input type="text" class="form-control" placeholder="Enter Here...." name="accountname" value="{{list.accountname}}" required>
               </div>   
            </div>

            <div class="col-lg-4 col-md-12 col-sm-12">
               <div class="form-group">
                  <label>Select Transction Type</label>
                  <select class="form-control" name="transctiontype">
                     <option value="">----Select Transction Type----</option>
                     <option value="DEBIT" {% if list.transctiontype == "DEBIT" %} selected {% else%} {%endif%}>DEBIT</option>
                     <option value="CREDIT"  {% if list.transctiontype == "CREDIT" %} selected {% else%} {%endif%} >CREDIT</option>
                 
                  </select>
               </div>
            </div>
          
           
            <div class="col-lg-4 col-md-12 col-sm-12">
               <div class="form-group">
                  <label>Opening Balance</label>
                  <input type="text" class="form-control" name="openingbalance" value="{{list.openingbalance}}" required>
               </div>
            </div>
          

            <div class="col-lg-4 col-md-12 col-sm-12">

            <div class="form-group">
               <label>Street Address</label>
               <input type="text" class="form-control" placeholder="Enter Street Address *"
                   id="address" title="Only (a-z) letters are allowed." 
                   name="streetaddress" value="{{list.streetaddress|default:''}}" />
           </div>
           </div>
           <div class="col-lg-4 col-md-12 col-sm-12">
           <div class="form-group">
               <label>Near by Address</label>
               <input type="text" class="form-control"
                   placeholder="Enter Near by Address *" id='nearbyaddress'
                   title="Only (a-z) letters are allowed."  name="nearbyaddress"
                   value="{{list.nearbyaddress|default:''}}" />
           </div>
         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">
           <div class="form-group">
               <label>City</label>
               <input type="text" class="form-control" placeholder="Enter City *" id='city'
                   title="Only (a-z) letters are allowed."  name="city"
                   value="{{list.city|default:''}}" />
           </div>

         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">
           <div class="form-group">
               <label>State</label>
               <input type="text" class="form-control" placeholder="Enter State *"
                   id='state' title="Only (a-z) letters are allowed."  name="state"
                   value="{{list.state|default:''}}" />
           </div>

         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">
           <div class="form-group">
               <label>Country</label>
               <input type="text" class="form-control" placeholder="Enter Country *"
                   id='country' title="Only (a-z) letters are allowed." 
                   name="country" value="{{list.country|default:''}}" />
           </div>

         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">

           <div class="form-group">
               <label>Pincode</label>
               <input type="text" placeholder="Enter Pincode *" id='pincode'
                   class="form-control" minlength="6" maxlength="6" name="pincode"
                   value="{{list.pincode|default:''}}" />
           </div>
         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">


            
            <div class="form-group">
               <label>PAN Card No</label>
               <input type="text" class="form-control" placeholder="PAN Number *"
                   pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}"
                   title="Please enter the correct PAN number." name="pancardno"
                   value="{{list.pancardno|default:''}}" />
           </div>

         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">


           <div class="form-group">
               <label>PAN Card Image </label>
               {% if list.pancarddoc %}
               <a href="{{list.pancarddoc.url}}"> <img alt="image"
                       src="{{list.pancarddoc.url}}" height="50" weight="50" /></a>
               {% else %}
               {% endif %}
               <input type="file" class="form-control" accept="application/pdf, image/*"
                   name="pancarddoc" />
           </div>

         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">
            <div class="form-group">
               <label>GST No</label>
               <input type="text" class="form-control" placeholder="GST NO *"
                   title="Please enter the correct gstno number." name="gstno"
                   value="{{list.gstno|default:''}}" />
           </div>
         </div>
         <div class="col-lg-4 col-md-12 col-sm-12">

           <div class="form-group">
               <label>GST Image</label>
               {% if storeobj.gstnodoc %}
               <a href="{{list.gstnodoc.url}}"> <img alt="image"
                       src="{{list.gstnodoc.url}}" height="50" weight="50" /></a>
               {% else %}
               {% endif %}
               <input type="file" class="form-control" accept="application/pdf, image/*"
                   name="gstnodoc" />
           </div>

           <input type="hidden" placeholder="latitude *" id='latitude' class="form-control"
           name="latitude"  />
       <input type="hidden" placeholder="longitude *" id='longitude'
           class="form-control" name="longitude"
           />
         </div>


           
           
         </div>
                    
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
         <button type="submit" class="btn btn-success">Save changes</button>
       </div>
      </form>
     </div>
   </div>
 </div>

{% endfor %}


 <!-- Modal -->
 <div class="modal fade" id="AddProductModal" tabindex="-1" role="dialog" aria-labelledby="AddProductModalLabel" aria-hidden="true">
   <div class="modal-dialog  modal-xl" role="document">
     <div class="modal-content">
       <!-- Modal content-->
       <div class="modal-content">
         <div class="modal-header">
             <h4 class="modal-title">Add </h4>
             <button type="button" class="close" data-dismiss="modal">&times;</button>
         </div>
         <div class="modal-body">
            <form method="POST" id="manual_journal_form" enctype="multipart/form-data">
               {% csrf_token %}
               <input type="hidden" name="hidden" value="2" id="itemValue">
               <input type="hidden" name="lead_id1" value="{{lead}}">
               <div class="row">
                 <div class="col-lg-4 col-md-6 col-sm-12">
                   <div class="form-group position-relative error-l-50">
                     <div class="row">
                       <span style="color: red;" id="journal_date_mgs"></span>
                       <div class="col-lg-12 col-md-12 col-sm-12">
                         <div class="form-group">
                           <label>Date</label>
                           <input type="date" class="form-control" name="journal_date" required>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
               </div>
               <div class="row mt-4">
                 <div class="col-sm-12 col-lg-12">
                   <div class="estimate-button-div">
                     <div>
                       <span><strong style="font-size: 18px;">Account</strong></span>
                       <span id="journal_message" style="color: red; position: relative; left: 20px;"></span>
                     </div>
                     <div>
                       <span><button type="button" class="estimate-button" onclick="addAccount();"><i class="fa fa-plus-circle" style="padding: 5px 0px 0px 0px;"></i></button></span>
                       <span><button type="button" class="estimate-button" onclick="removeAccount();" id="remove_account"><i class="fa fa-minus-circle" style="padding: 5px 0px 0px 0px;"></i></button></span>
                     </div>
                   </div>
                   <div class="table-responsive" style="background-color: #f0f0f0;">
                     <span class="badge badge-success" id="serviePriceUpdateMgs"></span>
                     <table class="table table-hover data-table responsive nowrap" style="text-align: center;">
                       <thead>
                         <tr>
                           <th>Account</th>
                           <th>Transaction Type</th>
                           <th>Debit</th>
                           <th>Credit</th>
                         </tr>
                       </thead>
                       <tbody id="accountTable">
                         <tr>
                           <td>
                             <label class="form-group has-float-label">
                               <select class="form-control account-class" name="account0" data-width="100%" id="selectedServiceId0" onchange="selectsService();">
                                 <option value="">-----Select Account-----</option>
                                 {% for accountype in accounttypegroups %}
                                 <optgroup style="font-size:16px;" label="{{accountype.name}}">{{accountype.name}}</optgroup>
                                 {% for first in accountype.accounttypegroups.all %}
                                 <option style="font-size:16px;" value="{{first.id}}">{{first.name}}</option>
                                 {% endfor %}
                                 {% endfor %}
                               </select>
                             </label>
                           </td>
                           <td>
                             <label class="form-group has-float-label">
                               <select class="form-control account-class" name="transactiontype0" data-width="100%" id="transaction0" onchange="inputTransaction(0);">
                                 <option style="font-size:16px;" value="">----Select Transaction Type----</option>
                                 <option style="font-size:16px;" value="DEBIT">DEBIT</option>
                                 <option style="font-size:16px;" value="CREDIT">CREDIT</option>
                               </select>
                             </label>
                           </td>
                           <td><input name="deb0" class="form-control input-debit" style="width: 115px;" type="number" id="deb0" min="0" onchange="totalDebit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57"></td>
                           <td><input name="cre0" class="form-control input-credit" style="width: 115px;" type="number" id="cre0" min="0" onchange="totalCredit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57"></td>
                         </tr>
                         <tr>
                           <td>
                             <label class="form-group has-float-label">
                               <select class="form-control account-class" name="account1" data-width="100%" id="selectedServiceId1" onchange="selectsService();">
                                 <option value="">-----Select Account-----</option>
                                 {% for accountype in accounttypegroups %}
                                 <optgroup style="font-size:16px;" label="{{accountype.name}}">{{accountype.name}}</optgroup>
                                 {% for first in accountype.accounttypegroups.all %}
                                 <option style="font-size:16px;" value="{{first.id}}">{{first.name}}</option>
                                 {% endfor %}
                                 {% endfor %}
                               </select>
                             </label>
                           </td>
                           <td>
                             <label class="form-group has-float-label">
                               <select class="form-control account-class" name="transactiontype1" data-width="100%" id="transaction1" onchange="inputTransaction(1);">
                                 <option style="font-size:16px;" value="">----Select Transaction Type----</option>
                                 <option style="font-size:16px;" value="DEBIT">DEBIT</option>
                                 <option style="font-size:16px;" value="CREDIT">CREDIT</option>
                               </select>
                             </label>
                           </td>
                           <td><input name="deb1" class="form-control input-debit" style="width: 115px;" type="number" id="deb1" min="0" onchange="totalDebit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57"></td>
                           <td><input name="cre1" class="form-control input-credit" style="width: 115px;" type="number" id="cre1" min="0" onchange="totalCredit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57"></td>
                         </tr>
                       </tbody>
                     </table>
                   </div>
                 </div>
               </div>
               <div class="row" style="margin-bottom: 20px;">
                 <div style="height: 114px;width: 861px; position: relative;left: 250px;">
                   <div style="padding: 46px;display: flex;justify-content: space-between; background-color: #f0f0f0;">
                     <span style="position: relative;left: 56px;"><strong>Total&nbsp;(₹)</strong></span>
                     <span style="position: relative;left: 88px;"><strong id="tDebit">0.00</strong></span>
                     <span style="position: relative;left: -5px;"><strong id="tCredit">0.00</strong></span>
                   </div>
                 </div>
               </div>
               <button class="btn btn-primary" type="button" name="button" form="manual_journal_form" onclick="submitForm();">Add Journal</button>
             </form>
            
         </div>
      </div>
   </div>
</div>
        



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

 
 <script type="text/javascript">
 
 document.getElementById('remove_account').disabled = true;
 
 function addAccount() {
   let table = document.getElementById('accountTable');
   let item = document.getElementById('itemValue').value;
   document.getElementById('itemValue').value = Number(item) + 1;
   let row = table.insertRow();
   let account = row.insertCell(0);
   let transactiontype = row.insertCell(1);
   let debit = row.insertCell(2);
   let credit = row.insertCell(3);
 
   account.innerHTML = `<label class="form-group has-float-label">
                         <select class="form-control account-class" name="account${item}" id="selectedServiceId${item}" data-width="100%" required style="width: 150%;height: 44px;font-size: 14px;" onchange="selectsService();">
                           <option value="">-----Select Account-----</option>
                           {% for accountype in accounttypegroups %}
                           <optgroup style="font-size:16px;" label="{{accountype.name}}">{{accountype.name}}</optgroup>
                           {% for first in accountype.accounttypegroups.all %}
                           <option style="font-size:16px;" value="{{first.id}}">{{first.name}}</option>
                           {% endfor %}
                           {% endfor %}
                         </select>
                        </label>`;
 
   transactiontype.innerHTML = `<label class="form-group has-float-label">
                                 <select class="form-control account-class" name="transactiontype${item}" data-width="100%" style="width: 115px; position: relative; left: 100%; top:-4px;" id="transaction${item}" onchange="inputTransaction(${item});">
                                   <option style="font-size:16px;" value="">----Select Transaction Type----</option>
                                   <option style="font-size:16px;" value="DEBIT">DEBIT</option>
                                   <option style="font-size:16px;" value="CREDIT">CREDIT</option>
                                 </select>
                                </label>`;
 
   debit.innerHTML = `<input name="deb${item}" class="form-control input-debit" style="width: 115px; position: relative; left: 125%; top:-4px;" type="number" id="deb${item}" min="0" onchange="totalDebit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57">`;
   credit.innerHTML = `<input name="cre${item}" class="form-control input-credit" style="width: 115px; position: relative; left: 85%; top:-4px;" type="number" id="cre${item}" min="0" onchange="totalCredit();" onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57">`;
 
   document.getElementById('remove_account').disabled = false;
 }
 
 function removeAccount() {
   let table = document.getElementById('accountTable');
   document.getElementById('itemValue').value = Number(document.getElementById('itemValue').value) - 1;
   table.removeChild(table.lastElementChild);
   if (document.getElementById('itemValue').value == '1') {
     document.getElementById('remove_account').disabled = true;
   }
 }
 
 function inputTransaction(id) {
   let transactionType = document.getElementById(`transaction${id}`).value;
   if (transactionType == 'DEBIT') {
     document.getElementById(`cre${id}`).disabled = true;
     document.getElementById(`deb${id}`).disabled = false;
     document.getElementById(`cre${id}`).value = '';
   } else if (transactionType == 'CREDIT') {
     document.getElementById(`deb${id}`).disabled = true;
     document.getElementById(`cre${id}`).disabled = false;
     document.getElementById(`deb${id}`).value = '';
   } else {
     document.getElementById(`deb${id}`).disabled = false;
     document.getElementById(`cre${id}`).disabled = false;
   }
   totalDebit();
   totalCredit();
 }
 
 function totalDebit() {
   let totalDebit = 0;
   let debit = document.getElementsByClassName('input-debit');
   for (let i = 0; i < debit.length; i++) {
     totalDebit += Number(debit[i].value);
   }
   document.getElementById('tDebit').innerHTML = `₹${totalDebit.toFixed(2)}`;
 }
 
 function totalCredit() {
   let totalCredit = 0;
   let credit = document.getElementsByClassName('input-credit');
   for (let i = 0; i < credit.length; i++) {
     totalCredit += Number(credit[i].value);
   }
   document.getElementById('tCredit').innerHTML = `₹${totalCredit.toFixed(2)}`;
 }
 
 function submitForm() {
   let debit = document.getElementById('tDebit').innerHTML;
   let credit = document.getElementById('tCredit').innerHTML;
   let manual_form = document.forms['manual_journal_form'];
   let account_counter = 0;
   let account_class = document.getElementsByClassName('account-class');
 
   if (account_class.length > 0) {
     for (let i = 0; i < account_class.length; i++) {
       if (account_class[i].value == '') {
         account_counter += 1;
       }
     }
   }
 
   if (account_counter > 0) {
     document.getElementById('selectAccount').innerHTML = 'Please select an account';
   } else if (manual_form['journal_date'].value == '') {
     document.getElementById('journal_date_mgs').innerHTML = 'Please select a date';
     document.getElementById('selectAccount').innerHTML = '';
   } else if ((Number(debit.substr(1)) == Number(credit.substr(1))) && (Number(debit.substr(1)) > 0) && (Number(credit.substr(1)) > 0)) {
     document.getElementById('journal_message').innerHTML = '';
     manual_form.submit();
     document.getElementById('journal_date_mgs').innerHTML = '';
     document.getElementById('selectAccount').innerHTML = '';
   } else {
     document.getElementById('journal_message').innerHTML = 'Please ensure debits and credits are equal and greater than zero.';
     document.getElementById('journal_date_mgs').innerHTML = '';
     document.getElementById('selectAccount').innerHTML = '';
   }
 }
 </script>
 

{% endblock %}